FROM docker-registry.usersys.redhat.com/bayesian/f8a-worker
MAINTAINER Tomas Tomecek <ttomecek@redhat.com>

ENV PYTHONDONTWRITEBYTECODE 1

COPY . /f8a_worker
WORKDIR /f8a_worker
RUN cd tests && pip3 install -r ./requirements.txt

# Install f8a-license-check prerelease if present in lib dir
RUN ls f8a-license-check-unreleased.rpm && \
    dnf install -y f8a-license-check-unreleased.rpm; \
    exit 0 # We expect the initial `ls` may fail

RUN useradd -o -u 1000 -G mock f8a
USER f8a

CMD ["py.test"]
